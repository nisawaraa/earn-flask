{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <h3 class="mb-4">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h3>
  <div class="row">

    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏£‡∏≤‡∏ü -->
    <div class="col-lg-7">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          ‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
        </div>
        <div class="card-body text-center">
          <img src="data:image/png;base64,{{ yearly_img }}" class="img-fluid" alt="Yearly Chart">
        </div>
      </div>
    </div>

    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ -->
    <div class="col-lg-5">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-danger text-white">
          üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
        </div>
        <div class="card-body">
          {% set max_val = (yearly | map(attribute='cases') | max) %}
          {% for row in yearly %}
            <p class="mb-1">
              <b>{{ row['year'] }}</b>:
              <span class="badge 
                {% if row['cases'] == max_val %} bg-danger 
                {% elif row['cases'] > (max_val*0.6) %} bg-warning 
                {% else %} bg-success {% endif %}">
                {{ row['cases'] }} ‡∏Ñ‡∏ô
              </span>
            </p>
            <div class="progress mb-3" style="height: 8px;">
              <div class="progress-bar 
                {% if row['cases'] == max_val %} bg-danger 
                {% elif row['cases'] > (max_val*0.6) %} bg-warning 
                {% else %} bg-success {% endif %}"
                role="progressbar" 
                style="width: {{ (row['cases'] / max_val * 100) | round(1) }}%;">
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
  <div class="text-center mt-3">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-danger">
      ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    </a>
  </div>

</div>
{% endblock %}
